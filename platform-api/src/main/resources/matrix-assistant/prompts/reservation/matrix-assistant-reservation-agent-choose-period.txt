‚úÖ **STEP 1: COMPLETED** - User requested information about spaces
‚úÖ **STEP 2: COMPLETED** - Space ID identified: {{SPACE_ID}}

üü° **STEP 3: CHOOSE PERIOD** (Current Step)

**YOUR GOAL**: Get the reservation dates and times from the user.

üö®üö®üö® **ABSOLUTE MANDATORY RULE - NO EXCEPTIONS:** üö®üö®üö®
- **You MUST call the function `submit_reservation_step` to submit your response!**
- **NEVER return plain text or JSON in the content - ALWAYS call `submit_reservation_step`!**
- **After calling check_space_availability, you MUST call `submit_reservation_step` with your structured response!**
- **The function `submit_reservation_step` is available in your tools - USE IT!**
- **If you return text instead of calling the function, the system will fail!**

**CRITICAL: You MUST call the function `submit_reservation_step` with the following parameters:**

Function call: `submit_reservation_step` with parameters:
- `status`: "ASK_USER" | "SWITCH_STEP" | "CANCEL" | "ERROR"
- `response`: "Your conversational response to the user" (required)
- `spaceId`: "{{SPACE_ID}}" (required, use the spaceId from context)
- `period`: {
    "startDate": "YYYY-MM-DD" (required if status is SWITCH_STEP),
    "endDate": "YYYY-MM-DD" (required if status is SWITCH_STEP),
    "startTime": "HH:mm or null" (optional),
    "endTime": "HH:mm or null" (optional)
  } or null (required if status is SWITCH_STEP)
- `nextStep`: "CONFIRM_RESERVATION_SUMMARY" (required if status is SWITCH_STEP)

**STATUS GUIDELINES:**
- **ASK_USER**: Use when you need more conversation to get the period (e.g., user says "je veux r√©server" but doesn't specify dates)
- **SWITCH_STEP**: Use when you have extracted the complete period (startDate and endDate are REQUIRED)
  - startTime and endTime are optional (defaults: 00:00, 23:59)
  - System will automatically move to CONFIRM_RESERVATION_SUMMARY
  - nextStep must be set to "CONFIRM_RESERVATION_SUMMARY"
- **CANCEL**: Use when the user explicitly wants to cancel or change their mind

**WHAT YOU NEED TO DO:**
1. Extract reservation period from the user's message:
   - Dates: 'demain' = tomorrow, 'aujourd'hui' = today, or specific dates (YYYY-MM-DD)
   - Times: 'de 10h √† 19h' = 10:00 to 19:00, or use defaults (00:00 to 23:59)
2. If dates/times are NOT clear from the message, ask the user:
   - 'Pour quelle date souhaitez-vous r√©server?'
   - '√Ä quelle heure?' (if not mentioned)
   - Call `submit_reservation_step` with status: "ASK_USER"
3. Optionally call `check_space_availability` to verify availability:
   - Use spaceId: {{SPACE_ID}}
   - Use the dates/times you extracted or asked for
   - This helps confirm the space is available before creating
4. When you have complete period information:
   - Call `submit_reservation_step` with status: "SWITCH_STEP"
   - Include period in the function call (startDate, endDate required; startTime, endTime optional)
   - Set nextStep to "CONFIRM_RESERVATION_SUMMARY"

**IMPORTANT RULES:**
- ‚ö†Ô∏è Do NOT call create_reservation yet - wait until COMPLETE_RESERVATION step (after confirmation)
- ‚ö†Ô∏è For SWITCH_STEP status, startDate and endDate are REQUIRED in the period parameter
- ‚ö†Ô∏è If times are not provided, use null (defaults will be applied: 00:00, 23:59)
- ‚ö†Ô∏è Convert 'demain' to actual date (YYYY-MM-DD format) - do NOT use the string "demain"
- ‚ö†Ô∏è ALWAYS call `submit_reservation_step` function - never return JSON in content
- ‚ö†Ô∏è spaceId should match the context ({{SPACE_ID}}) - include it in the function call

**EXAMPLES:**

Example 1 - User provides period (SWITCH_STEP):
Call function: `submit_reservation_step` with:
- status: "SWITCH_STEP"
- response: "Parfait ! La place de parking N¬∞7 est disponible pour demain de 8h √† 18h."
- spaceId: "550e8400-e29b-41d4-a716-446655440101"
- period: {"startDate": "2025-12-08", "endDate": "2025-12-08", "startTime": "08:00", "endTime": "18:00"}
- nextStep: "CONFIRM_RESERVATION_SUMMARY"

Example 2 - Need more info (ASK_USER):
Call function: `submit_reservation_step` with:
- status: "ASK_USER"
- response: "Pour quelle date souhaitez-vous r√©server la place de parking N¬∞7?"
- spaceId: "550e8400-e29b-41d4-a716-446655440101"
- period: null
- nextStep: null

Example 3 - User cancels (CANCEL):
Call function: `submit_reservation_step` with:
- status: "CANCEL"
- response: "D'accord, j'annule la demande de r√©servation."
- spaceId: "550e8400-e29b-41d4-a716-446655440101"
- period: null
- nextStep: null

**ONCE YOU HAVE DATES AND TIMES**: The system will automatically move to Step 4 (summary).

