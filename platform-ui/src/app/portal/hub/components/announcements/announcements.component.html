<div
    class="announcements-info"
    *ngIf="showNotification()"
>
    <tui-notification size="l">
        <span>{{ 'announcements.info' | translate }}</span>
        <button
            iconStart="@tui.x"
            tuiIconButton
            type="button"
            (click)="closeNotification()"
        >
            Close
        </button>
    </tui-notification>
</div>

<div class="announcements-create-form">
    <form
        [formGroup]="pageForm"
        (ngSubmit)="onPostCreate()"
    >
        <!-- Desktop tabs -->
        <tui-tabs
            [(activeItemIndex)]="activeItemIndex"
            class="desktop-tabs"
        >
            <button
                *ngFor="let category of categoryInfo; trackBy: trackByCategory"
                tuiTab
                type="button"
                (click)="changePostCategory(category.category)"
            >
                <tui-icon
                    [style.font-size.rem]="1"
                    [icon]="category.icon"
                    [style.color]="activePostCategory === category.category ? category.color : null"
                    class="announcement-icon"
                ></tui-icon>
                {{ category.translationKey | translate }}
            </button>
        </tui-tabs>

        <!-- Mobile dropdown -->
        <div class="mobile-category-selector">
            <label tuiLabel>Category</label>
            <select
                [ngModel]="activePostCategory"
                (ngModelChange)="changePostCategory($event)"
                [ngModelOptions]="{standalone: true}"
                name="postCategory"
                class="category-dropdown"
            >
                <option
                    *ngFor="let category of categoryInfo; trackBy: trackByCategory"
                    [value]="category.category"
                >
                    {{ category.translationKey | translate }}
                </option>
            </select>
        </div>

        <tui-textfield>
            <label tuiLabel>
                {{ 'announcement-post-form.title' | translate }}
            </label>
            <input
                id="title"
                formControlName="title"
                type="text"
                placeholder="{{ 'announcement-post-form.title-placeholder' | translate }}"
                tuiTextfield
                (focus)="onInputFocus()"
                (click)="onInputFocus()"
            >
        </tui-textfield>

        <tui-expand [expanded]="!collapsed()">

            <quill-editor
                formControlName="content"
                [modules]="editorConfig"
                style="height: 200px"
            ></quill-editor>

            <div class="announcement-post-form-actions">
                <button
                    class="save-button"
                    type="submit"
                    appearance="accent"
                    size="m"
                    tuiButton
                    [disabled]="pageForm.invalid"
                >
                    {{ 'announcement-post-form.save' | translate }}
                </button>
            </div>
        </tui-expand>

    </form>

</div>

<!-- Pagination Info -->
<div
    class="pagination-info"
    *ngIf="paginationData()"
>
    <span class="pagination-text">
        {{ 'announcements.showing' | translate }}
        {{ ((paginationData()!.currentPage - 1) * paginationParams().pageSize!) + 1 }} - 
        {{ Math.min(paginationData()!.currentPage * paginationParams().pageSize!, paginationData()!.totalItems) }}
        {{ 'announcements.of' | translate }} {{ paginationData()!.totalItems }}
        {{ 'announcements.results' | translate }}
    </span>
</div>

<div
    class="announcements-container"
    *ngIf="announcements() as announcements; else loading"
>

    <div
        class="announcement"
        *ngFor="let announcement of announcements"
    >
        <announcement
            [announcement]="announcement"
            (announcementDeleted)="loadAnnouncements()"
            (announcementUpdated)="loadAnnouncements()"
        ></announcement>
    </div>
</div>

<!-- Pagination Controls -->
<div
    class="pagination-controls"
    *ngIf="paginationData() && paginationData()!.totalPages > 1"
>
    <tui-pagination
        [length]="paginationData()!.totalPages"
        [index]="paginationData()!.currentPage - 1"
        (indexChange)="onPageChange($event + 1)"
        [sidePadding]="2"
        [activePadding]="1"
    ></tui-pagination>

    <div class="page-size-selector">
        <label tuiLabel>
            {{ 'announcements.items-per-page' | translate }}
        </label>
        <select
            (ngModelChange)="onPageSizeChange($event)"
            [ngModel]="paginationParams().pageSize"
            [ngModelOptions]="{standalone: true}"
            name="pageSize"
        >
            <option value="5">5</option>
            <option value="10">10</option>
            <option value="20">20</option>
            <option value="50">50</option>
        </select>
    </div>
</div>
<ng-template #loading>
    <p>Loading announcements...</p>
</ng-template>
