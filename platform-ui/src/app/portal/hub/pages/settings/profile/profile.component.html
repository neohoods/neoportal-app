<div class="profile-container">

  @if (profileIncomplete) {
    <tui-notification appearance="warning" class="profile-warning">
      {{ 'profile.completionRequired' | translate }}
    </tui-notification>
  }

  <form [formGroup]="profileForm" (ngSubmit)="onSave()">
    <h1>{{ 'profile.editTitle' | translate }}</h1>
    <button 
      appearance="accent" 
      tuiButton 
      size="l" 
      type="submit" 
      class="save-button-top"
      [disabled]="!profileForm.valid"
      [tuiHint]="getSaveButtonTooltip()"
      [tuiHintDirection]="'bottom'"
      [tuiHintAppearance]="'onDark'"
    >
      {{ 'profile.saveButton' | translate }}
    </button>

    <!-- Privacy Settings -->
    <h3>{{ 'profile.privacySettings' | translate }}</h3>

    <div class="form-field">
      <div class="privacy-toggle">
        <input tuiSwitch type="checkbox" formControlName="profileSharingConsent">
        <label>{{ 'profile.profileSharingConsent' | translate }}</label>
        <tui-icon tuiHintDirection="right" [tuiTooltip]="'profile.profileSharingConsentDescription' | translate" />
      </div>
    </div>

    <!-- Basic Information -->
    <h3>{{ 'profile.basicInfo' | translate }}</h3>

    <tui-textfield class="form-field">
      <label tuiLabel for="username">{{ 'profile.username' | translate }} <span class="required">*</span></label>
      <input id="username" formControlName="username" type="text" placeholder="{{ 'profile.usernamePlaceholder' | translate }}"
        tuiTextfield />
    </tui-textfield>

    <div class="row form-field">
      <div class="column">
        <tui-textfield>
          <label tuiLabel for="firstName">{{ 'profile.firstName' | translate }} <span class="required">*</span></label>
          <input id="firstName" formControlName="firstName" type="text" placeholder="{{ 'profile.firstNamePlaceholder' | translate }}"
            tuiTextfield />
        </tui-textfield>
      </div>
      <div class="column">
        <tui-textfield>
          <label tuiLabel for="lastName">{{ 'profile.lastName' | translate }} <span class="required">*</span></label>
          <input id="lastName" formControlName="lastName" type="text" placeholder="{{ 'profile.lastNamePlaceholder' | translate }}"
            tuiTextfield />
        </tui-textfield>
      </div>
    </div>
    
    @if (!user.type) {
      <tui-textfield tuiChevron [stringify]="stringifyUserType" class="form-field">
        <label tuiLabel>{{ 'profile.type' | translate }} <span class="required">*</span></label>
        <input tuiSelect formControlName="type" name="type" />

        <tui-data-list-wrapper *tuiTextfieldDropdown new [items]="userTypes" [itemContent]="userTypeContent" />
      </tui-textfield>

      <ng-template #userTypeContent let-item>
        {{ 'user.type.' + item | translate }}
      </ng-template>
    } @else {
      <tui-textfield class="form-field">
        <label tuiLabel>{{ 'profile.type' | translate }}</label>
        <input [value]="'user.type.' + user.type | translate" tuiTextfield readonly />
      </tui-textfield>
    }


    <tui-textfield class="form-field">
      <label tuiLabel for="email">{{ 'profile.email' | translate }} <span class="required">*</span></label>
      <input id="email" formControlName="email" type="email" placeholder="{{ 'profile.emailPlaceholder' | translate }}"
        tuiTextfield />
    </tui-textfield>

    <tui-notification appearance="info" size="m" class="phone-info-notification">
      <div>{{ 'profile.phoneInfo' | translate }}</div>
    </tui-notification>

    <tui-textfield class="form-field">
      <label tuiLabel for="phone">{{ 'profile.phone' | translate }}</label>
      <input id="phone" formControlName="phone" tuiInputPhone [mask]="'+33 # ## ## ## ##'" />
    </tui-textfield>

    @if (!isSSOUser) {
      <tui-textfield class="form-field">
        <label tuiLabel for="password">{{ 'profile.password' | translate }}</label>
        <input id="password" formControlName="password" type="password" placeholder="{{ 'profile.passwordPlaceholder' | translate }}"
          tuiTextfield />
        <tui-icon tuiPassword />
      </tui-textfield>
    }

    <!-- Address Fields -->
    <h3>{{ 'profile.addressInfo' | translate }}</h3>

    <tui-textfield class="form-field">
      <label tuiLabel for="flatNumber">{{ 'profile.flatNumber' | translate }}</label>
      <input id="flatNumber" formControlName="flatNumber" type="text" placeholder="{{ 'profile.flatNumberPlaceholder' | translate }}"
        tuiTextfield />
    </tui-textfield>

    <div class="row form-field">
      <div class="column">
        <tui-textfield>
          <label tuiLabel for="streetAddress">{{ 'profile.streetAddress' | translate }} <span class="required">*</span></label>
          <input id="streetAddress" formControlName="streetAddress" type="text"
            placeholder="{{ 'profile.streetAddressPlaceholder' | translate }}" 
            tuiTextfield />
        </tui-textfield>
      </div>
      <div class="column">
        <tui-textfield>
          <label tuiLabel for="city">{{ 'profile.city' | translate }} <span class="required">*</span></label>
          <input id="city" formControlName="city" type="text" placeholder="{{ 'profile.cityPlaceholder' | translate }}"
            tuiTextfield />
        </tui-textfield>
      </div>
    </div>

    <div class="row form-field">
      <div class="column">
        <tui-textfield>
          <label tuiLabel for="postalCode">{{ 'profile.postalCode' | translate }} <span class="required">*</span></label>
          <input id="postalCode" formControlName="postalCode" type="text"
            placeholder="{{ 'profile.postalCodePlaceholder' | translate }}" 
            tuiTextfield />
        </tui-textfield>
      </div>
      <div class="column">
        <tui-textfield>
          <label tuiLabel for="country">{{ 'profile.country' | translate }} <span class="required">*</span></label>
          <input id="country" formControlName="country" type="text" placeholder="{{ 'profile.countryPlaceholder' | translate }}"
            tuiTextfield />
        </tui-textfield>
      </div>
    </div>
    <button 
      appearance="accent" 
      tuiButton 
      size="l" 
      type="submit"
      [disabled]="!profileForm.valid"
      [tuiHint]="getSaveButtonTooltip()"
      [tuiHintDirection]="'top'"
      [tuiHintAppearance]="'onDark'"
    >
      {{ 'profile.saveButton' | translate }}
    </button>
  </form>
</div>